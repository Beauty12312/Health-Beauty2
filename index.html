<!DOCTYPE html><html lang="ar" dir="rtl"><head><meta charset="UTF-8">

<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Ù…Ø¬Ù„Ø© Ø§Ù„Ø¬Ù…Ø§Ù„ Ø§Ù„Ø¹ØµØ±ÙŠØ©</title>

<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;500;800&display=swap" rel="stylesheet">

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script><style>

:root {

    --primary-color: #d4af37; /* Ø°Ù‡Ø¨ÙŠ */

    --bg-dark: #121212;

    --bg-panel: #1e1e1e;

    --text-light: #e0e0e0;

    --danger-color: #ff4444;

    --success-color: #00c851;

}* { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Tajawal', sans-serif; }



body { background-color: var(--bg-dark); color: var(--text-light); overflow-x: hidden; }



/* --- 1. ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø¬Ù„Ø© --- */ .book-container { max-width: 1000px; margin: 20px auto; padding: 40px; background: var(--bg-panel); box-shadow: 0 0 30px rgba(0,0,0,0.7); border-radius: 2px; border-top: 5px solid var(--primary-color); min-height: 90vh; position: relative; } header { text-align: center; padding-bottom: 20px; border-bottom: 1px solid #333; margin-bottom: 30px; } h1 { color: var(--primary-color); font-size: 3rem; margin-bottom: 10px; letter-spacing: 1px; } .subtitle { color: #888; font-size: 1.2rem; margin-bottom: 25px; }



.search-wrapper { position: relative; max-width: 600px; margin: 0 auto 20px auto; display: flex; align-items: center; } .search-input { width: 100%; padding: 15px 20px; padding-left: 50px; border-radius: 30px; border: 2px solid #333; background: #151515; color: #fff; outline: none; font-size: 1.1rem; transition: 0.3s; } .search-input:focus { border-color: var(--primary-color); box-shadow: 0 0 10px rgba(212, 175, 55, 0.2); } .search-btn-icon { position: absolute; left: 15px; background: none; border: none; color: #777; cursor: pointer; font-size: 1.4rem; transition: 0.3s; }



#public-content { display: block; animation: fadeIn 1s ease; } .articles-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 25px; margin-bottom: 40px; } .article-card { background: #252525; border-radius: 8px; overflow: hidden; transition: 0.3s; box-shadow: 0 4px 10px rgba(0,0,0,0.3); } .article-card:hover { transform: translateY(-5px); } .card-img { width: 100%; height: 180px; object-fit: cover; opacity: 0.9; } .card-content { padding: 15px; } .card-content h3 { font-size: 1.1rem; margin-bottom: 10px; color: var(--primary-color); } .card-content p { font-size: 0.9rem; color: #ccc; margin-bottom: 15px; height: 40px; overflow: hidden; text-overflow: ellipsis; } .read-more-btn { display: inline-block; padding: 8px 20px; background: transparent; border: 1px solid var(--primary-color); color: var(--primary-color); text-decoration: none; border-radius: 4px; cursor: pointer; transition: 0.3s; font-size: 0.9rem; } .read-more-btn:hover { background: var(--primary-color); color: #000; }



#article-viewer { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 3000; overflow-y: auto; padding: 20px; } .article-view-content { max-width: 800px; margin: 40px auto; background: #1e1e1e; padding: 30px; border-radius: 10px; position: relative; border: 1px solid #333; } .close-article-btn { position: absolute; top: 20px; left: 20px; background: none; border: none; color: #fff; font-size: 2rem; cursor: pointer; z-index: 10; } #view-img { width: 100%; height: 300px; object-fit: cover; border-radius: 5px; margin-bottom: 20px; } #view-title { color: var(--primary-color); font-size: 2rem; margin-bottom: 20px; } #view-text { line-height: 1.8; color: #ddd; font-size: 1.1rem; white-space: pre-line; }



/* --- 2. ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© --- */ #chat-interface { display: none; flex-direction: column; width: 100%; height: 650px; background: #151515; border: 1px solid #333; border-radius: 10px; position: relative; margin-top: 10px; } #private-chat-interface { display: none; flex-direction: column; width: 100%; height: 650px; background: #0f0f0f; border: 1px solid #443; border-radius: 10px; position: relative; margin-top: 10px; }



/* Ø´Ø±ÙŠØ· Ø§Ù„Ù…ØªØµÙ„ÙŠÙ† */ .online-users-bar { padding: 10px 15px; background: #111; border-bottom: 1px solid #333; border-radius: 10px 10px 0 0; display: flex; gap: 10px; overflow-x: auto; align-items: center; height: 60px; } .online-user { background: #222; padding: 5px 12px; border-radius: 20px; font-size: 0.85rem; white-space: nowrap; display: flex; align-items: center; gap: 6px; border: 1px solid #333; } .online-dot { width: 8px; height: 8px; background-color: var(--success-color); border-radius: 50%; box-shadow: 0 0 5px var(--success-color); }



.chat-header { padding: 10px 15px; background: #1a1a1a; border-bottom: 1px solid #333; display: flex; justify-content: space-between; align-items: center; } .chat-box { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 15px; }



.message { max-width: 85%; padding: 10px 15px; border-radius: 15px; position: relative; animation: fadeIn 0.3s ease; word-wrap: break-word; font-size: 0.95rem; } .message-sender { font-size: 0.75rem; margin-bottom: 4px; font-weight: bold; } .message img, .message video { max-width: 100%; border-radius: 10px; margin-top: 5px; border: 1px solid #444; } .message audio { width: 100%; min-width: 220px; margin-top: 8px; height: 50px; border-radius: 8px; background-color: #f1f3f4; display: block; }



.sticker-msg { background: transparent !important; padding: 0 !important; box-shadow: none !important; } .sticker-img { width: 140px; height: 140px; object-fit: contain; animation: pulse 0.5s ease; filter: drop-shadow(0 0 5px rgba(0,0,0,0.5)); }



.timer-bar { height: 3px; background: var(--primary-color); position: absolute; bottom: 0; right: 0; width: 100%; border-radius: 0 0 15px 15px; }



.chat-tools { background: #1a1a1a; padding: 8px; display: flex; gap: 10px; border-top: 1px solid #333; justify-content: center; align-items: center; } .tool-btn { background: none; border: none; font-size: 1.3rem; cursor: pointer; filter: grayscale(1); transition: 0.3s; position: relative; } .tool-btn:hover { filter: grayscale(0); transform: scale(1.2); }



.radio-active { animation: pulse-color 1.5s infinite; color: var(--success-color) !important; filter: none !important; }



.chat-input-area { padding: 15px; background: #1a1a1a; display: flex; gap: 10px; align-items: center; border-radius: 0 0 10px 10px; position: relative;} #msg-input { flex: 1; text-align: right; background: #252525; border-radius: 25px; padding: 10px 20px; outline: none; color: #fff; border: 1px solid #333;} #private-msg-input { flex: 1; text-align: right; background: #252525; border-radius: 25px; padding: 10px 20px; outline: none; color: #fff; border: 1px solid #333;}



#recording-status { display: none; flex: 1; color: var(--danger-color); font-weight: bold; animation: pulse 1s infinite; text-align: center; } #cancel-record-btn { display: none; background: none; border: none; color: #888; font-size: 1.5rem; cursor: pointer; } #cancel-record-btn:hover { color: var(--danger-color); } #record-trigger-btn { background: #333; color: #fff; width: 45px; height: 45px; border-radius: 50%; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; transition: 0.2s; box-shadow: 0 0 10px rgba(0,0,0,0.5); } #record-trigger-btn.active { background: var(--danger-color); }



#typing-indicator { position: absolute; bottom: 70px; right: 20px; font-size: 0.8rem; color: var(--primary-color); font-style: italic; display: none; animation: fadeIn 0.3s ease; background: rgba(0,0,0,0.7); padding: 5px 10px; border-radius: 10px; }



/* --- Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù„ØµÙ‚Ø§Øª --- */ #sticker-picker { display: none; position: absolute; bottom: 80px; left: 50%; transform: translateX(-50%); width: 95%; max-width: 480px; height: 450px; background: #222; border: 1px solid #444; border-radius: 15px; z-index: 9999; flex-direction: column; box-shadow: 0 0 30px rgba(0,0,0,0.9); } .sticker-tabs { display: flex; border-bottom: 1px solid #444; overflow-x: auto; padding: 8px; gap: 5px; } .sticker-tab { padding: 8px 15px; text-align: center; cursor: pointer; background: #1a1a1a; color: #aaa; font-size: 0.85rem; border-radius: 20px; white-space: nowrap; transition: 0.2s; border: 1px solid #333; } .sticker-tab.active { background: var(--primary-color); color: #000; font-weight: bold; border-color: var(--primary-color); } .sticker-content { flex: 1; overflow-y: auto; padding: 10px; display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; align-content: start; } .sticker-item { width: 100%; cursor: pointer; transition: 0.2s; border-radius: 8px; aspect-ratio: 1/1; object-fit: cover; } .sticker-item:hover { transform: scale(1.05); background: rgba(255,255,255,0.05); }



/* --- Ù†Ø§ÙØ°Ø© Ø§Ù„Ø±Ø§Ø¯ÙŠÙˆ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© --- / #radio-picker { display: none; position: absolute; bottom: 90px; / Ø±ÙØ¹Ù†Ø§ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù„Ù„Ø£Ø¹Ù„Ù‰ */ right: 50px; background: #1a1a1a; border: 1px solid var(--primary-color); border-radius: 10px; width: 220px; padding: 10px; z-index: 25; flex-direction: column; gap: 5px; box-shadow: 0 0 20px rgba(0,0,0,0.9); } .radio-option { padding: 10px; background: #252525; color: #fff; border-radius: 5px; cursor: pointer; text-align: center; font-size: 0.9rem; transition: 0.2s; border: 1px solid #333; margin-bottom: 5px; } .radio-option:hover { background: #333; border-color: var(--primary-color); } .radio-option.playing { background: var(--success-color); border-color: var(--success-color); color: #fff; animation: pulse 1s infinite; } .radio-stop { background: var(--danger-color) !important; margin-top: 5px; }



/* Ø²Ø± Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© */ .menu-close-btn { color: #ff4444; float: left; cursor: pointer; font-size: 1.2rem; padding: 0 5px; } .menu-close-btn:hover { transform: scale(1.2); }



.modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 2000; align-items: center; justify-content: center; } .modal-box { background: #151515; padding: 30px; border-radius: 15px; border: 1px solid var(--primary-color); text-align: right; width: 90%; max-width: 400px; } .decoy-input { width: 100%; padding: 10px; margin: 10px 0; border-radius: 5px; border: 1px solid #444; background: #222; color: #fff; outline: none; text-align: center; } .decoy-input:disabled { background: #333; color: #555; border-color: #333; cursor: not-allowed; }



.btn-login { padding: 10px 30px; background: var(--primary-color); border: none; border-radius: 4px; cursor: pointer; font-weight: bold; margin-top: 10px; color: #111; width: 100%; } .btn-danger { background: var(--danger-color); color: white; margin-top: 15px; }



.timer-control-group { background: #222; padding: 15px; border-radius: 8px; margin: 15px 0; border: 1px solid #333; margin-bottom: 10px; } .checkbox-wrapper { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; font-weight: bold; color: var(--primary-color); cursor: pointer; } input[type=checkbox] { transform: scale(1.5); cursor: pointer; accent-color: var(--primary-color); }



#emoji-picker { display: none; position: absolute; bottom: 80px; right: 20px; background: #222; border: 1px solid #444; padding: 10px; border-radius: 10px; width: 300px; flex-wrap: wrap; gap: 5px; height: 180px; overflow-y: auto; z-index: 9999; } .emoji-item { font-size: 1.6rem; cursor: pointer; padding: 6px; }



@keyframes fadeIn { from { opacity: 0;} transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } } @keyframes fadeOut { from { opacity: 1; } to { opacity: 0; } } @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } } @keyframes pulse-color { 0% { text-shadow: 0 0 5px var(--success-color); } 50% { text-shadow: 0 0 20px var(--success-color); } 100% { text-shadow: 0 0 5px var(--success-color); } }

.msg-actions {
    display: none;
    gap: 8px;
    margin-top: 5px;
    border-top: 1px solid rgba(255,255,255,0.1);
    padding-top: 5px;
}
.message:hover .msg-actions {
    display: flex;
}
.action-btn {
    background: none;
    border: none;
    color: #aaa;
    font-size: 0.8rem;
    cursor: pointer;
    transition: 0.2s;
}
.action-btn:hover { color: var(--primary-color); }
.action-btn.del:hover { color: var(--danger-color); }

.msg-time {
    font-size: 0.65rem;
    color: rgba(255, 255, 255, 0.5);
    margin-top: 4px;
    display: block;
    text-align: left; /* Ø³ÙŠØ¸Ù‡Ø± ÙÙŠ Ø¬Ù‡Ø© Ø§Ù„ÙŠØ³Ø§Ø± Ø¯Ø§Ø®Ù„ ÙÙ‚Ø§Ø¹Ø© Ø§Ù„Ø±Ø³Ø§Ù„Ø© */
}
/* Ù„ØªØºÙŠÙŠØ± Ù…ÙƒØ§Ù† Ø§Ù„ÙˆÙ‚Øª ÙÙŠ Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¢Ø®Ø±ÙŠÙ† */
.message[style*="flex-start"] .msg-time {
    text-align: right;
}


</style></head>



<body><audio id="radio-player" preload="none"></audio><div class="book-container">

    <header>

        <h1>Ø£Ø³Ø±Ø§Ø± Ø§Ù„Ø¬Ù…Ø§Ù„ ÙˆØ§Ù„Ù…ÙƒÙŠØ§Ø¬</h1>

        <p class="subtitle">Ø§Ù„Ù…Ø±Ø¬Ø¹ Ø§Ù„Ø£ÙˆÙ„ Ù„Ù„Ø£Ù†Ø§Ù‚Ø© ÙˆØ§Ù„Ø¬Ø§Ø°Ø¨ÙŠØ© Ø§Ù„Ø¹ØµØ±ÙŠØ©</p><div class="search-wrapper" id="search-wrapper">

        <input type="text" id="header-search" class="search-input" placeholder="Ø§Ø¨Ø­Ø«ÙŠ Ø¹Ù† Ù…Ù‚Ø§Ù„ØŒ Ù…Ù†ØªØ¬ØŒ Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ù…ÙŠ Ø±Ù…Ø² Ø§Ù„Ø¯Ø®ÙˆÙ„..." onkeypress="handleSearchKey(event)">

        <button class="search-btn-icon" onclick="checkSecretCode()">ğŸ”</button>

    </div>

</header><div id="public-content">

    <div class="articles-grid">

        <div class="article-card">

            <img src="https://images.unsplash.com/photo-1522337660859-02fbefca4702?w=600" class="card-img">

            <div class="card-content">

                <h3>Ø£Ø³Ø§Ø³ÙŠØ§Øª Ø§Ù„Ù…ÙƒÙŠØ§Ø¬ Ø§Ù„ÙŠÙˆÙ…ÙŠ</h3>

                <p>ØªØ¹Ø±ÙÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø·ÙˆØ§Øª Ø§Ù„ØµØ­ÙŠØ­Ø© Ù„ÙˆØ¶Ø¹ Ù…ÙƒÙŠØ§Ø¬ Ù†Ø§Ø¹Ù… ÙˆØ¬Ø°Ø§Ø¨ Ù„Ù„Ø¹Ù…Ù„.</p>

                <button class="read-more-btn" onclick="showArticle(1)">Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ø²ÙŠØ¯</button>

            </div>

        </div>

        <div class="article-card">

            <img src="https://images.unsplash.com/photo-1596462502278-27bfdd403348?w=600" class="card-img">

            <div class="card-content">

                <h3>Ø±ÙˆØªÙŠÙ† Ø§Ù„Ø¹Ù†Ø§ÙŠØ© Ø§Ù„Ù„ÙŠÙ„ÙŠ</h3>

                <button class="read-more-btn" onclick="showArticle(2)">Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ø²ÙŠØ¯</button>

            </div>

        </div>

    </div>

    <div style="text-align: center; margin-top: 50px; border: 1px solid #333; padding: 30px; border-radius: 10px;">

        <h3 style="color: var(--primary-color);">Ø§Ø´ØªØ±ÙƒÙŠ ÙÙŠ Ø§Ù„Ù†Ø´Ø±Ø© Ø§Ù„Ø¨Ø±ÙŠØ¯ÙŠØ©</h3>

        <input type="text" class="decoy-input" style="width: 60%;" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">

        <button class="btn-login" style="width: 60%;" onclick="alert('Ø´ÙƒØ±Ø§Ù‹ Ù„Ø§Ø´ØªØ±Ø§ÙƒÙƒ!')">Ø§Ø´ØªØ±Ø§Ùƒ</button>

    </div>

</div><div id="chat-interface">

    <div class="online-users-bar" id="online-users-list">

        <span style="color:#666; font-size:0.8rem;">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„...</span>

    </div><div class="chat-header">

    <h3>Ù…Ø¬Ù„Ø© Ø§Ù„Ø¬Ù…Ø§Ù„ Ù„Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…Ø§Øª</h3>

    <div>

        <button class="tool-btn" onclick="checkSettingsAccess()">âš™ï¸</button>

        <!-- Ù‚ÙÙ„ Ø§Ù„ØºØ±ÙØ© Ø§Ù„Ø®Ø§Øµ -->

        <button class="tool-btn" id="private-lock-btn" title="Ù‚Ø³Ù… Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†" onclick="openPrivateLock()">ğŸ”’</button>

        <button class="tool-btn" onclick="exitChat()">âœ–</button>

    </div>

</div>



<div class="chat-box" id="chat-box">

    <div class="message" style="background:transparent; border:1px solid #444; align-self:center; color:#888; text-align:center;">

        Ø§Ù‡Ù„Ø§ ÙˆØ³Ù‡Ù„Ø§ ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†Ø§ Ø®Ø¯Ù…ØªÙƒÙ…

    </div>

</div>



<div id="typing-indicator"></div>



<div class="chat-tools">

    <button id="record-trigger-btn" title="Ø§Ø¶ØºØ· Ù„Ù„Ø¨Ø¯Ø¡ØŒ Ø§Ø¶ØºØ· Ø§Ø±Ø³Ø§Ù„ Ù„Ù„Ø¥Ù†Ù‡Ø§Ø¡" onclick="startRecordingMode()">ğŸ™ï¸</button>

    <button id="radio-btn" class="tool-btn" onclick="toggleRadioMenu()" title="Ø§Ø®ØªØ± Ù…Ø­Ø·Ø© Ø±Ø§Ø¯ÙŠÙˆ">ğŸ“»</button>

    <!-- Ø²Ø± Ø§ÙŠÙ‚Ø§Ù Ø§Ù„Ø±Ø§Ø¯ÙŠÙˆ Ø§Ù„Ø³Ø±ÙŠØ¹ -->

    <button class="tool-btn" onclick="stopRadio()" title="Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø±Ø§Ø¯ÙŠÙˆ">â¹ï¸</button>

    <button class="tool-btn" onclick="toggleStickers()" title="Ù…Ù„ØµÙ‚Ø§Øª">ğŸ’–</button>

    <button class="tool-btn" onclick="toggleEmoji()" title="Ø¥ÙŠÙ…ÙˆØ¬ÙŠ">ğŸ˜€</button>

    <button class="tool-btn" onclick="triggerUpload('image')">ğŸ“·</button>

    <button class="tool-btn" onclick="triggerUpload('video')">ğŸ¥</button>

</div>



<div id="radio-picker">

    </div>



<div id="emoji-picker"></div>



<div id="sticker-picker">

    <div class="sticker-tabs">

        <div class="sticker-tab active" data-cat="romantic" onclick="showStickerCategory('romantic', this)">Ø­Ø¨ ÙˆØ±ÙˆÙ…Ø§Ù†Ø³ÙŠØ©</div>

        <div class="sticker-tab" data-cat="funny" onclick="showStickerCategory('funny', this)">Ù…Ø¶Ø­Ùƒ</div>

        <div class="sticker-tab" data-cat="sad" onclick="showStickerCategory('sad', this)">Ø­Ø²ÙŠÙ†</div>

        <div class="sticker-tab" data-cat="sports" onclick="showStickerCategory('sports', this)">Ø±ÙŠØ§Ø¶Ø©</div>

        <div class="sticker-tab" data-cat="cats" onclick="showStickerCategory('cats', this)">Ù‚Ø·Ø·</div>

        <div class="sticker-tab" data-cat="hi" onclick="showStickerCategory('hi', this)">ØªØ­ÙŠØ©</div>

        <div class="sticker-tab" data-cat="action" onclick="showStickerCategory('action', this)">Ø£ÙƒØ´Ù†</div>

        <div class="sticker-tab" data-cat="mixed" onclick="showStickerCategory('mixed', this)">Ù…Ù†ÙˆØ¹Ø©</div>

    </div>

    <div class="sticker-content" id="sticker-content"></div>

</div>



<div class="chat-input-area">

    <button id="cancel-record-btn" title="Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ³Ø¬ÙŠÙ„" onclick="cancelRecording()">ğŸ—‘ï¸</button>

    <div id="recording-status">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„...</div>

    <input type="text" id="msg-input" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø©..." disabled>

    <button class="tool-btn" id="send-btn" onclick="handleSendMessageClick()" style="color: var(--primary-color); filter: none;">â¤</button>

</div>



</div><!-- === ØºØ±ÙØ© Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„Ø³Ø±ÙŠØ© Ø§Ù„Ø®Ø§ØµØ© === --><div id="private-chat-interface">

    <div class="online-users-bar" id="online-users-list-private">

        <span style="color:#aaa; font-size:0.9rem;">Ù‚Ø³Ù… Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† ÙˆØ§Ù„Ø§Ø±Ø´Ø§Ø¯Ø§Øª</span>

    </div><div class="chat-header" style="background:#171717; border-bottom:1px solid #443;">

    <h3>Ù‚Ø³Ù… Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ù„Ù„Ù…Ø¬Ù„Ø©</h3>

    <div>

        <button class="tool-btn" onclick="deleteAllPrivateMessages()" title="Ø­Ø°Ù ÙƒÙ„ Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†">ğŸ—‘ï¸</button>

        <button class="tool-btn" onclick="closePrivateChat()" title="Ø®Ø±ÙˆØ¬">âœ–</button>

    </div>

</div>



<div class="chat-box" id="private-chat-box">

    <div class="message" style="background:transparent; border:1px solid #443; align-self:center; color:#aaa; text-align:center;">

 Ù‚Ø³Ù… Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† ÙˆØ§Ù„Ø§Ø±Ø´Ø§Ø¯Ø§Øª.

    </div>

</div>



<div class="chat-tools">

    <button id="private-record-trigger-btn" title="Ø§Ø¶ØºØ· Ù„Ù„Ø¨Ø¯Ø¡ØŒ Ø§Ø¶ØºØ· Ø§Ø±Ø³Ø§Ù„ Ù„Ù„Ø¥Ù†Ù‡Ø§Ø¡" onclick="startRecordingMode()">ğŸ™ï¸</button>

    <button class="tool-btn" id="private-radio-btn" onclick="toggleRadioMenu()" title="Ø§Ø®ØªØ± Ù…Ø­Ø·Ø© Ø±Ø§Ø¯ÙŠÙˆ">ğŸ“»</button>

    <button class="tool-btn" onclick="stopRadio()" title="Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø±Ø§Ø¯ÙŠÙˆ">â¹ï¸</button>

    <button class="tool-btn" onclick="toggleStickers()" title="Ù…Ù„ØµÙ‚Ø§Øª">ğŸ’–</button>

    <button class="tool-btn" onclick="toggleEmoji()" title="Ø¥ÙŠÙ…ÙˆØ¬ÙŠ">ğŸ˜€</button>

    <button class="tool-btn" onclick="triggerPrivateUpload('image')">ğŸ“·</button>

    <button class="tool-btn" onclick="triggerPrivateUpload('video')">ğŸ¥</button>

</div>



<div id="private-emoji-picker" style="display:none"></div>



<div class="chat-input-area">

    <button id="private-cancel-record-btn" title="Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ³Ø¬ÙŠÙ„" onclick="cancelRecording()">ğŸ—‘ï¸</button>

    <div id="private-recording-status" style="display:none">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„...</div>

    <input type="text" id="private-msg-input" placeholder="Ø±Ø³Ø§Ù„Ø© Ø³Ø±ÙŠØ©..." disabled>

    <button class="tool-btn" id="private-send-btn" onclick="handleSendMessageClick()" style="color: var(--primary-color); filter: none;">â¤</button>

</div>



</div></div><input type="file" id="upload-image" accept="image/*" hidden onchange="sendFile(this, 'image')" data-target="public">

<input type="file" id="upload-video" accept="video/*" hidden onchange="sendFile(this, 'video')" data-target="public">

<input type="file" id="upload-audio" accept="audio/*" hidden onchange="sendFile(this, 'audio')" data-target="public"><div id="name-modal" class="modal-overlay">

    <div class="modal-box">

        <h3 style="color: var(--primary-color); text-align: center;">Ø§Ù„Ù‡ÙˆÙŠØ© Ù…Ø·Ù„ÙˆØ¨Ø©</h3>

        <input type="text" id="username-input" class="decoy-input" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ¹Ø§Ø±">

        <button class="btn-login" onclick="setUsername()">Ø¯Ø®ÙˆÙ„</button>

    </div>

</div><div id="article-viewer">

    <div class="article-view-content">

        <button class="close-article-btn" onclick="closeArticle()">âœ–</button>

        <img id="view-img" src="" alt="">

        <h2 id="view-title"></h2>

        <p id="view-text"></p>

    </div>

</div><div id="settings-modal" class="modal-overlay">

    <div class="modal-box">

        <h3 style="color: var(--primary-color); text-align: center; margin-bottom: 20px;">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØºØ±ÙØ©</h3><label>ØªØºÙŠÙŠØ± Ø±Ù…Ø² Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø³Ø±ÙŠ:</label>

    <input type="text" id="code-setting" class="decoy-input"><label>ØªØºÙŠÙŠØ± Ø±Ù…Ø² Ø§Ù„Ù…Ø´Ø±Ù (Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª):</label>

<input type="text" id="admin-code-setting" class="decoy-input" placeholder="Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ 2023">



<div class="timer-control-group">

    <label class="checkbox-wrapper">

        <input type="checkbox" id="timer-toggle" onchange="toggleTimerInputState()">

        ØªÙØ¹ÙŠÙ„ Ø­Ø°Ù Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ (Ø§Ù„Ù…Ø¤Ù‚Øª)

    </label>

    <label style="font-size: 0.9rem; color: #aaa;">ÙˆÙ‚Øª Ø§Ù„Ø­Ø°Ù (Ø¨Ø§Ù„Ø«ÙˆØ§Ù†ÙŠ):</label>

    <input type="number" id="timer-setting" class="decoy-input" min="1" placeholder="Ù…Ø«Ù„Ø§Ù‹: 5">

</div>



<div class="timer-control-group">

    <label class="checkbox-wrapper">

        <input type="checkbox" id="inactivity-toggle" onchange="toggleInactivityInputState()">

        ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ

    </label>

    <label style="font-size: 0.9rem; color: #aaa;">ÙˆÙ‚Øª Ø§Ù„Ø®Ø±ÙˆØ¬ (Ø¨Ø§Ù„Ø«ÙˆØ§Ù†ÙŠ):</label>

    <input type="number" id="inactivity-setting" class="decoy-input" min="10">

</div>



<div style="border-top: 1px solid #333; margin-top: 15px; padding-top: 15px;">

    <button class="btn-login" onclick="saveSettings()">Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>

    <button class="btn-login btn-danger" onclick="deleteAllMessages()">ğŸ—‘ï¸ Ø­Ø°Ù ÙƒÙ„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„</button>

    <button class="btn-login" style="background: #333; color: #ccc; margin-top: 10px;" onclick="closeSettings()">Ø¥Ù„ØºØ§Ø¡</button>

</div>



</div></div><script>

    
    const SUPABASE_URL = 'https://wcjpptcrcaxmiyltcirz.supabase.co'; 
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndjanBwdGNyY2F4bWl5bHRjaXJ6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE3NTE5MTksImV4cCI6MjA4NzMyNzkxOX0.-OOJoGa1h27eLotTvDmgnFrpLtmlRkNU8dmZgOB7v0E';

    const MEDIA_BUCKET_NAME = 'CHAT_MEDIA'; let supabaseClient;

try { supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY); } catch (e) { console.error(e); }



let appSettings = { 

    deleteSeconds: 7, inactivityTimeout: 120, entranceCode: "Ù†ÙˆØ±Ù¡Ø³Ø§Ù…ÙŠ", 

    timerEnabled: true, inactivityEnabled: true, adminCode: "2023" 

};

let inactivityTimer;

let username = "";

let userColor = "#fff";

let currentChatTarget = 'public'; // 'public' or 'private'



let mediaRecorder;

let audioChunks = [];

let isRecording = false; 

let presenceChannel;

let hideTypingTimer;

let isRadioPlaying = false;



const articlesData = {

    1: { title: "Ø£Ø³Ø§Ø³ÙŠØ§Øª Ø§Ù„Ù…ÙƒÙŠØ§Ø¬ Ø§Ù„ÙŠÙˆÙ…ÙŠ", img: "https://images.unsplash.com/photo-1522337660859-02fbefca4702?w=800", text: "Ø§Ù„Ù†Øµ Ù‡Ù†Ø§..." },

    2: { title: "Ø±ÙˆØªÙŠÙ† Ø§Ù„Ø¹Ù†Ø§ÙŠØ© Ø§Ù„Ù„ÙŠÙ„ÙŠ", img: "https://images.unsplash.com/photo-1596462502278-27bfdd403348?w=800", text: "Ø§Ù„Ù†Øµ Ù‡Ù†Ø§..." }

};



// === ØªØ¹Ø±ÙŠÙ Ù…Ø­Ø·Ø§Øª Ø§Ù„Ø±Ø§Ø¯ÙŠÙˆ Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚ÙŠØ© ===

const radioStations = {

    iraqi: { name: "Ø£ØºØ§Ù†ÙŠ Ø¹Ø±Ø§Ù‚ÙŠØ© ğŸ‡®ğŸ‡¶", url: "https://stream.zeno.fm/0r0xa792kwzuv" },

    syrian: { name: "Ø´Ø§Ù…ÙŠ / Ø³ÙˆØ±ÙŠ ğŸ‡¸ğŸ‡¾", url: "https://l3.itworkscdn.net/itwaudio/9030/stream" }, 

    mix: { name: "Ù…Ù†ÙˆØ¹Ø§Øª Ø¹Ø±Ø¨ÙŠØ© ğŸ¶", url: "https://stream.zeno.fm/r2gn1644m0quv" },

    foreign: { name: "Ø£ØºØ§Ù†ÙŠ Ø£Ø¬Ù†Ø¨ÙŠØ© ğŸ‡ºğŸ‡¸", url: "https://stream-mixtape-geo.ntslive.net/mixtape2" }

};



// === Ù…ÙƒØªØ¨Ø© Ø§Ù„Ù…Ù„ØµÙ‚Ø§Øª (Ù…ÙˆØ³Ø¹Ø©) ===

const stickers = {

    romantic: [

        "https://media.giphy.com/media/26BRv0ThflsHCqDrG/giphy.gif","https://media.giphy.com/media/l4pTfx2qLszoacZRS/giphy.gif","https://media.giphy.com/media/3o7TKoWXm3okO1kgHC/giphy.gif","https://media.giphy.com/media/26FLdmIp6wJr91JAI/giphy.gif",

        "https://media.giphy.com/media/l2Je2M4Nfrit0L7sQ/giphy.gif","https://media.giphy.com/media/1hqb8LwPS2xCNNNBQF/giphy.gif","https://media.giphy.com/media/l0HlPtbGpcnqa0fja/giphy.gif","https://media.giphy.com/media/xT0GqFhyNd0Tmbuqc0/giphy.gif",

        "https://media.giphy.com/media/l0MYB8Ory7Hqefo9a/giphy.gif","https://media.giphy.com/media/3o6Zt6ML6BklcajjsA/giphy.gif"

    ],

    funny: [

        "https://media.giphy.com/media/3oEjHAUOqG3lSS0f1C/giphy.gif","https://media.giphy.com/media/10yXFkBJ0MwGQ0/giphy.gif","https://media.giphy.com/media/ZqlvCTNHpqrio/giphy.gif","https://media.giphy.com/media/ltIFdxPB9JhoTpEEt9/giphy.gif",

        "https://media.giphy.com/media/3o7aD6fX2kYQwV3pWQ/giphy.gif","https://media.giphy.com/media/5GoVLqeAOo6PK/giphy.gif","https://media.giphy.com/media/1BXa2alBjrCXC/giphy.gif"

    ],

    sad: [

        "https://media.giphy.com/media/OPU6wzx8JrHna/giphy.gif","https://media.giphy.com/media/7SF5scGBwjWWQ/giphy.gif","https://media.giphy.com/media/d2lcHJy5yqgAU/giphy.gif","https://media.giphy.com/media/L95W4wv8nnb9K/giphy.gif"

    ],

    sports: [

        "https://media.giphy.com/media/i4jTE9ZNFQQ1D7OXlg/giphy.gif","https://media.giphy.com/media/l0HlO3BJ8L9s0/giphy.gif","https://media.giphy.com/media/3o7TPs6f8Q5C6w7U2c/giphy.gif","https://media.giphy.com/media/xT9DPlAUKTl1GeZjC8/giphy.gif"

    ],

    cats: [

        "https://media.giphy.com/media/JIX9t2j0ZTN9S/giphy.gif","https://media.giphy.com/media/mlvseq9yvZhba/giphy.gif","https://media.giphy.com/media/BzyTuYCmvSORqs1ABM/giphy.gif","https://media.giphy.com/media/3oriO0OEd9QIDdllqo/giphy.gif"

    ],

    hi: [

        "https://media.giphy.com/media/xT9IgG50Fb7Mi0prBC/giphy.gif","https://media.giphy.com/media/3pZipqyo1sqHDfJGtz/giphy.gif","https://media.giphy.com/media/dzaUX7CAG0Ihi/giphy.gif","https://media.giphy.com/media/Cmr1OMJ2FN0B2/giphy.gif"

    ],

    action: [

        "https://media.giphy.com/media/3oEjI6SIIHBdRxXI40/giphy.gif","https://media.giphy.com/media/26xBI73gWquCBBCDe/giphy.gif","https://media.giphy.com/media/l0HlQ7LRal2m0KxWw/giphy.gif","https://media.giphy.com/media/3o7aD6sQwG3mY2fG6g/giphy.gif",

        "https://media.giphy.com/media/12NUbkX6p4xOO4/giphy.gif","https://media.giphy.com/media/3o6ZsY3XQ3aK1f8N8k/giphy.gif"

    ],

    mixed: [

        "https://media.giphy.com/media/3o7aD2saalBwwftBIY/giphy.gif","https://media.giphy.com/media/5GoVLqeAOo6PK/giphy.gif","https://media.giphy.com/media/26DnVq5bZ3C3u2QWc/giphy.gif","https://media.giphy.com/media/xT0GqssRweIhlz209i/giphy.gif",

        "https://media.giphy.com/media/3o6Mbbs879ozZ9Yic0/giphy.gif","https://media.giphy.com/media/26FPqut4q8u8pH8Ji/giphy.gif"

    ]

};



window.onload = async function() {

    if(supabaseClient) {

        let { data } = await supabaseClient.from('settings').select().eq('id', 1).single();

        if (data) updateLocalSettings(data);

        supabaseClient.channel('public:settings').on('postgres_changes', { event: 'UPDATE', schema: 'public', table: 'settings' }, (payload) => {

            updateLocalSettings(payload.new);

            if(document.getElementById('settings-modal').style.display === 'flex') populateSettingsUI();

        }).subscribe();

    }

    initRadioMenu();

    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„Ù„Ù…Ù„ØµÙ‚Ø§Øª

    showStickerCategory('romantic');



    // Move pickers to body to ensure visibility in both public and private chats

    ['sticker-picker','emoji-picker','radio-picker'].forEach(id=>{

        const el = document.getElementById(id);

        if (el && el.parentNode !== document.body) document.body.appendChild(el);

    });

};



function updateLocalSettings(data) {

    appSettings = { 

        deleteSeconds: data.delete_seconds, inactivityTimeout: data.inactivity_timeout, 

        entranceCode: data.entrance_code, timerEnabled: data.timer_enabled, 

        inactivityEnabled: data.inactivity_enabled, adminCode: data.admin_code 

    };

}



function handleSearchKey(e) { if (e.key === 'Enter') checkSecretCode(); }

function checkSecretCode() {

    const val = document.getElementById('header-search').value.trim();

    if (val === appSettings.entranceCode || val === "2023" || val === "Ù†ÙˆØ±Ù¡Ø³Ø§Ù…ÙŠ") {

        document.getElementById('header-search').value = ""; 

        enterChatMode();

    } else { alert(`Ø§Ù„Ø±Ù…Ø² ØºÙŠØ± ØµØ­ÙŠØ­!`); }

}

function enterChatMode() {

    document.getElementById('search-wrapper').style.display = 'none';

    document.getElementById('public-content').style.display = 'none';

    document.getElementById('chat-interface').style.display = 'flex';

    document.getElementById('name-modal').style.display = 'flex';

}

function setUsername() {

    const nameIn = document.getElementById('username-input').value.trim();

    if (!nameIn) return alert("ÙŠØ¬Ø¨ ÙƒØªØ§Ø¨Ø© Ø§Ø³Ù…!");

    username = nameIn;

    userColor = `hsl(${Array.from(nameIn).reduce((acc, c) => acc + c.charCodeAt(0), 0) % 360}, 70%, 60%)`;

    document.getElementById('name-modal').style.display = 'none';

    document.getElementById('msg-input').disabled = false;

    document.getElementById('msg-input').placeholder = `Ø±Ø³Ø§Ù„Ø© Ù…Ù† ${username}...`;

    document.getElementById('private-msg-input').disabled = false;

    document.getElementById('private-msg-input').placeholder = `Ø§Ø±Ø³Ù„ Ø§Ù„Ø§Ù†${username}...`;

    

    startInactivityTimer();

    loadRecentMessages();

    startMessageListener();

    setupPresenceAndTyping(); 

    // Ù„Ø§ ØªØªÙ… Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ù‚Ù†Ø§Ø© Ø§Ù„Ø³Ø±ÙŠØ© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù…Ù† Ø¯ÙˆÙ† Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù‡Ø§

}

function exitChat() { location.reload(); }



function setupPresenceAndTyping() {

    if(!supabaseClient) return;

    presenceChannel = supabaseClient.channel('room_01');

    presenceChannel

        .on('presence', { event: 'sync' }, () => { updateOnlineUsersList(presenceChannel.presenceState()); })

        .on('broadcast', { event: 'typing' }, (payload) => {

            if(payload.payload.user !== username) showTypingIndicator(payload.payload.user);

        })

        .subscribe(async (status) => {

            if (status === 'SUBSCRIBED') {

                await presenceChannel.track({ user: username });

            }

        });

    const handleTyping = () => {
    if(presenceChannel) {
        presenceChannel.send({
            type: 'broadcast',
            event: 'typing',
            payload: { user: username },
            config: { method: 'http' } // Ù‡Ø°Ø§ Ù‡Ùˆ Ø§Ù„Ø¨Ø¯ÙŠÙ„ Ø§Ù„ØµØ­ÙŠØ­ ÙˆØ§Ù„Ø¢Ù…Ù† Ø­Ø§Ù„ÙŠØ§Ù‹
        });
    }
    resetInactivityTimer();
};


document.getElementById('msg-input').addEventListener('input', handleTyping);
document.getElementById('private-msg-input').addEventListener('input', handleTyping);


    document.getElementById('private-msg-input').addEventListener('input', () => {

        if(presenceChannel) presenceChannel.send({ type: 'broadcast', event: 'typing', payload: { user: username } });

        resetInactivityTimer();

    });

}



function updateOnlineUsersList(state) {

    const list = document.getElementById('online-users-list');

    list.innerHTML = '';

    const users = [];

    for (const id in state) {

        const user = state[id][0].user;

        if(!users.includes(user)) users.push(user);

    }

    users.forEach(u => {

        const div = document.createElement('div');

        div.className = 'online-user';

        div.innerHTML = `<div class="online-dot"></div> ${u}`;

        list.appendChild(div);

    });

}



function showTypingIndicator(user) {

    const ind = document.getElementById('typing-indicator');

    ind.textContent = `${user} ÙŠÙƒØªØ¨ Ø§Ù„Ø¢Ù†...`;

    ind.style.display = 'block';

    clearTimeout(hideTypingTimer);

    hideTypingTimer = setTimeout(() => { ind.style.display = 'none'; }, 3000);

}



// --- Radio Logic (Updated Fix) ---

function initRadioMenu() {

    const menu = document.getElementById('radio-picker');

    menu.innerHTML = ''; // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø£ÙˆÙ„Ø§Ù‹



    // Ø±Ø£Ø³ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù…Ø¹ Ø²Ø± Ø¥ØºÙ„Ø§Ù‚

    const header = document.createElement('div');

    header.style.display = 'flex';

    header.style.justifyContent = 'space-between';

    header.style.alignItems = 'center';

    header.style.marginBottom = '10px';

    header.style.borderBottom = '1px solid #333';

    header.style.paddingBottom = '5px';

    

    header.innerHTML = `<span style="color:#aaa; font-size:0.9rem;">Ø§Ø®ØªØ± Ù…Ø­Ø·Ø©:</span><span class="menu-close-btn" onclick="toggleRadioMenu()">âœ–</span>`;

    menu.appendChild(header);



    // Ø²Ø± Ø¥ÙŠÙ‚Ø§Ù

    const stopBtn = document.createElement('div');

    stopBtn.className = 'radio-option radio-stop';

    stopBtn.innerText = 'â¹ï¸ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø±Ø§Ø¯ÙŠÙˆ';

    stopBtn.onclick = stopRadio;

    menu.appendChild(stopBtn);



    // Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù…Ø­Ø·Ø§Øª

    for (const key in radioStations) {

        const station = radioStations[key];

        const btn = document.createElement('div');

        btn.className = 'radio-option';

        btn.id = `station-${key}`;

        btn.innerText = station.name;

        btn.onclick = () => playStation(key);

        menu.appendChild(btn);

    }

}



function toggleRadioMenu() {

    const menu = document.getElementById('radio-picker');

    const emoji = document.getElementById('emoji-picker');

    const sticker = document.getElementById('sticker-picker');

    

    emoji.style.display = 'none';

    sticker.style.display = 'none';



    if (menu.style.display === 'flex') {

        menu.style.display = 'none';

    } else {

        menu.style.display = 'flex';

    }

}



function playStation(key) {

    const player = document.getElementById('radio-player');

    const btn = document.getElementById('radio-btn');

    const station = radioStations[key];



    document.querySelectorAll('.radio-option').forEach(b => b.classList.remove('playing'));

    document.getElementById(`station-${key}`).classList.add('playing');



    player.src = station.url;

    player.play().then(() => {

        isRadioPlaying = true;

        btn.classList.add('radio-active');

        // === Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù‡Ù†Ø§: Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± ===

        document.getElementById('radio-picker').style.display = 'none';

    }).catch(e => alert("Ø¹Ø°Ø±Ø§Ù‹ØŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ´ØºÙŠÙ„ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø­Ø·Ø© Ø­Ø§Ù„ÙŠØ§Ù‹."));

}



function stopRadio() {

    const player = document.getElementById('radio-player');

    const btn = document.getElementById('radio-btn');

    

    try {

        player.pause();

        player.src = "";

    } catch (e) { /* ignore */ }

    isRadioPlaying = false;

    btn.classList.remove('radio-active');

    

    document.querySelectorAll('.radio-option').forEach(b => b.classList.remove('playing'));

    document.getElementById('radio-picker').style.display = 'none';

}



function toggleStickers() {

    const picker = document.getElementById('sticker-picker');

    const emoji = document.getElementById('emoji-picker');

    const radio = document.getElementById('radio-picker');

    emoji.style.display = 'none';

    radio.style.display = 'none';

    

    if (picker.style.display === 'flex') picker.style.display = 'none';

    else {

        picker.style.display = 'flex';

        // ensure default category visible

        const active = document.querySelector('.sticker-tab.active');

        if(active) showStickerCategory(active.dataset.cat, active);

        else showStickerCategory('romantic');

    }

}



function showStickerCategory(cat, el) {

    const content = document.getElementById('sticker-content');

    content.innerHTML = '';

    document.querySelectorAll('.sticker-tab').forEach(t => t.classList.remove('active'));

    const tabEl = el || document.querySelector(`.sticker-tab[data-cat="${cat}"]`);

    if(tabEl) tabEl.classList.add('active');

    const list = stickers[cat] || [];

    list.forEach(url => {

        const img = document.createElement('img');

        img.src = url;

        img.alt = cat + ' sticker';

        img.className = 'sticker-item';

        img.onclick = () => { sendMessage(url, 'sticker'); toggleStickers(); };

        content.appendChild(img);

    });

}



// === Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¹Ø§Ù…Ø© ===

async function loadRecentMessages() {

    if(!supabaseClient) return;

    const { data } = await supabaseClient.from('messages').select('*').order('created_at', { ascending: true }).limit(50);

    

    if (data) {

        data.forEach(msg => {

            const msgTime = new Date(msg.created_at).getTime();

            const age = (Date.now() - msgTime) / 1000;

            if (appSettings.timerEnabled && age > appSettings.deleteSeconds) {

                return; 

            }

            appendMessageToUI(msg.sender_name, msg.content, msg.type, msg.color, msg.sender_name === username, true, msg.id, false);

        });

        scrollToBottom();

    }

}



function handleSendMessageClick() {

    if (isRecording) finishRecordingAndSend();

    else {

        const text = currentChatTarget === 'private' ? document.getElementById('private-msg-input').value : document.getElementById('msg-input').value;

        sendMessage(text, 'text');

    }

}



// sendMessage now respects currentChatTarget and writes to either messages or private_messages

async function sendMessage(content, type = 'text', finalContent = null) {

    if (!username) return;

    const text = content ? content.trim() : "";

    const msgToSend = finalContent || text;

    if (!msgToSend && type === 'text') return;



    // handle admin code for settings entry only in public chat

    if (currentChatTarget === 'public' && text === appSettings.adminCode) { openSettings(); if(document.getElementById('msg-input')) document.getElementById('msg-input').value = ""; return; }

    if (currentChatTarget === 'private' && text === appSettings.adminCode) { alert('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø´Ø±Ù Ù„Ø§ ØªÙØªØ­ Ø£ÙŠ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù‡Ù†Ø§'); }



    // clear appropriate input

    if (currentChatTarget === 'public') {

        if(document.getElementById('msg-input')) document.getElementById('msg-input').value = "";

    } else {

        if(document.getElementById('private-msg-input')) document.getElementById('private-msg-input').value = "";

    }



    if(supabaseClient) {

        const table = currentChatTarget === 'private' ? 'private_messages' : 'messages';

        await supabaseClient.from(table).insert([{ sender_name: username, content: msgToSend, type: type, color: userColor }]);

    }

    resetInactivityTimer();

}

function startMessageListener() {
    if (!supabaseClient) return;

    ['messages', 'private_messages'].forEach(tableName => {
        supabaseClient.channel(tableName + '-realtime')
            .on('postgres_changes', { event: 'INSERT', schema: 'public', table: tableName }, (payload) => {
                appendMessageToUI(payload.new.sender_name, payload.new.content, payload.new.type, payload.new.color, payload.new.sender_name === username, false, payload.new.id, tableName === 'private_messages');
            })
            .on('postgres_changes', { event: 'UPDATE', schema: 'public', table: tableName }, (payload) => {
                const isPrivate = tableName === 'private_messages';
                const el = document.getElementById((isPrivate ? 'msg-private-' : 'msg-') + payload.new.id);
                if (el) {
                    const textDiv = el.querySelector('.msg-text-content');
                    if (textDiv) textDiv.textContent = payload.new.content;
                }
            })
            .on('postgres_changes', { event: 'DELETE', schema: 'public', table: tableName }, (payload) => {
                const isPrivate = tableName === 'private_messages';
                const el = document.getElementById((isPrivate ? 'msg-private-' : 'msg-') + payload.old.id);
                if (el) el.remove();
            })
            .subscribe();
    });
}



// === Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø®Ø§ØµØ© ===

async function loadRecentPrivateMessages() {

    if(!supabaseClient) return;

    const { data } = await supabaseClient.from('private_messages').select('*').order('created_at', { ascending: true }).limit(200);

    if (data) {

        data.forEach(msg => {

            appendMessageToUI(msg.sender_name, msg.content, msg.type, msg.color, msg.sender_name === username, true, msg.id, true);

        });

        scrollToBottom();

    }

}



function startPrivateMessageListener() {

    if(!supabaseClient) return;

    supabaseClient.channel('public:private_messages')

        .on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'private_messages' }, (payload) => {

            const { sender_name, content, type, color, id } = payload.new;

            appendMessageToUI(sender_name, content, type, color, sender_name === username, false, id, true);

        })

        .on('postgres_changes', { event: 'DELETE', schema: 'public', table: 'private_messages' }, (payload) => {

            const el = document.getElementById(`msg-private-${payload.old.id}`);

            if(el) el.remove();

        })

        .subscribe();

}



function appendMessageToUI(sender, content, type, color, isMine, isHistory, msgId, isPrivate = false, timestamp = null) {
    const targetBoxId = isPrivate ? 'private-chat-box' : 'chat-box';
    const chatBox = document.getElementById(targetBoxId);
    if (!chatBox) return;

    // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¹Ø¯Ù… ØªÙƒØ±Ø§Ø± Ø§Ù„Ø±Ø³Ø§Ù„Ø© ÙÙŠ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
    const existingId = (isPrivate ? 'msg-private-' : 'msg-') + msgId;
    if (document.getElementById(existingId)) return;

    // --- Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ÙˆÙ‚Øª ÙˆØ§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ ---
    const dateObj = timestamp ? new Date(timestamp) : new Date();
    const timeString = dateObj.toLocaleTimeString('ar-EG', { hour: '2-digit', minute: '2-digit' });
    const dateString = dateObj.toLocaleDateString('ar-EG', { day: 'numeric', month: 'short' });
    const fullTimeHTML = `<span class="msg-time" style="display:block; font-size:0.65rem; color:rgba(255,255,255,0.5); margin-top:6px; direction:ltr; text-align:${isMine ? 'left' : 'right'};">${dateString} | ${timeString}</span>`;

    // --- Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø±Ø³Ø§Ù„Ø© ---
    const msgDiv = document.createElement('div');
    msgDiv.className = 'message';
    msgDiv.id = existingId;
    msgDiv.style.alignSelf = isMine ? 'flex-end' : 'flex-start';
    msgDiv.style.position = 'relative'; // Ø¶Ø±ÙˆØ±ÙŠ Ù„ØªÙ…ÙˆØ¶Ø¹ Ø§Ù„Ø£Ø²Ø±Ø§Ø± ÙÙˆÙ‚ Ø§Ù„Ø±Ø³Ø§Ù„Ø©
    msgDiv.style.marginBottom = '15px';
    msgDiv.style.maxWidth = '85%';

    // ØªØ®ØµÙŠØµ Ø´ÙƒÙ„ Ø§Ù„ÙÙ‚Ø§Ø¹Ø©
    if (type === 'sticker') {
        msgDiv.classList.add('sticker-msg');
    } else {
        msgDiv.style.background = isMine ? 'linear-gradient(135deg, #d4af37, #b8952e)' : '#2a2a2a';
        msgDiv.style.color = isMine ? '#000' : '#fff';
        msgDiv.style.padding = '10px 15px';
        msgDiv.style.borderRadius = isMine ? '18px 18px 2px 18px' : '18px 18px 18px 2px';
        msgDiv.style.boxShadow = '0 2px 5px rgba(0,0,0,0.2)';
    }

    // --- Ø¥Ø¹Ø¯Ø§Ø¯ Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… (Ø­Ø°Ù ÙˆØªØ¹Ø¯ÙŠÙ„) ØªØ¸Ù‡Ø± Ù„Ù„Ù…Ø±Ø³Ù„ ÙÙ‚Ø· ---
    let controlsHTML = '';
    if (isMine) {
        controlsHTML = `
            <div class="msg-controls" style="position:absolute; top:-12px; ${isMine ? 'left:-5px' : 'right:-5px'}; display:flex; gap:4px; z-index:10;">
                <button title="Ø­Ø°Ù" onclick="deleteSingleMessage('${msgId}', '${isPrivate ? 'private' : 'public'}')" 
                    style="background:#ff4444; color:white; border:2px solid #1e1e1e; border-radius:50%; width:24px; height:24px; cursor:pointer; font-size:12px; font-weight:bold; display:flex; align-items:center; justify-content:center;">âœ•</button>
                ${type === 'text' ? `
                <button title="ØªØ¹Ø¯ÙŠÙ„" onclick="editMessage('${msgId}', '${isPrivate ? 'private' : 'public'}')" 
                    style="background:#00c851; color:white; border:2px solid #1e1e1e; border-radius:50%; width:24px; height:24px; cursor:pointer; font-size:12px; display:flex; align-items:center; justify-content:center;">âœï¸</button>
                ` : ''}
            </div>`;
    }

    // --- ØªØ¬Ù‡ÙŠØ² Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹ ---
    let contentHTML = '';
    // Ø§Ø³Ù… Ø§Ù„Ù…Ø±Ø³Ù„ (ÙŠØ¸Ù‡Ø± ÙÙŠ Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¢Ø®Ø±ÙŠÙ† Ø£Ùˆ Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…Ù„ØµÙ‚Ø§Ù‹)
    if (type !== 'sticker') {
        contentHTML += `<div class="message-sender" style="color:${isMine ? '#333' : color}; font-weight:800; font-size:0.75rem; margin-bottom:4px; border-bottom:1px solid rgba(0,0,0,0.05);">${sender}</div>`;
    }

    if (type === 'text') {
        contentHTML += `<div class="msg-text-content" style="word-break:break-word; line-height:1.5;">${content}</div>`;
    } else if (type === 'image') {
        contentHTML += `<img src="${content}" style="max-width:100%; border-radius:10px; border:1px solid rgba(255,255,255,0.1);" onload="scrollToBottom()">`;
    } else if (type === 'video') {
        contentHTML += `<video controls src="${content}" style="max-width:100%; border-radius:10px;"></video>`;
    } else if (type === 'audio') {
        contentHTML += `<audio controls src="${content}" style="width:100%; max-width:220px;"></audio>`;
    } else if (type === 'sticker') {
        contentHTML += `<img src="${content}" class="sticker-img" style="width:120px; height:120px; object-fit:contain;" onload="scrollToBottom()">`;
    }

    // Ø¯Ù…Ø¬ ÙƒÙ„ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø¯Ø§Ø®Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©
    msgDiv.innerHTML = controlsHTML + contentHTML + fullTimeHTML;
    
    // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ù„Ù„ØµÙ†Ø¯ÙˆÙ‚ ÙˆØ¹Ù…Ù„ Ø³ÙƒØ±ÙˆÙ„ Ù„Ù„Ø£Ø³ÙÙ„
    chatBox.appendChild(msgDiv);
    scrollToBottom();

    // --- Ù…Ù†Ø·Ù‚ Ø§Ù„Ø­Ø°Ù Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ (Ø§Ù„Ù…Ø¤Ù‚Øª) Ù„Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¹Ø§Ù…Ø© ÙÙ‚Ø· ---
    if (appSettings.timerEnabled && !isHistory && !isPrivate) {
        const timerBar = document.createElement('div');
        timerBar.className = 'timer-bar';
        timerBar.style.cssText = "height:3px; background:rgba(0,0,0,0.2); position:absolute; bottom:0; right:0; width:100%; border-radius:0 0 10px 10px;";
        msgDiv.appendChild(timerBar);
        
        setTimeout(() => { 
            timerBar.style.transition = `width ${appSettings.deleteSeconds}s linear`; 
            timerBar.style.width = '0%'; 
        }, 50);

        setTimeout(async () => {
            msgDiv.style.transition = '0.5s';
            msgDiv.style.opacity = '0';
            msgDiv.style.transform = 'scale(0.8)';
            setTimeout(() => { if(msgDiv.parentNode) msgDiv.remove(); }, 500);
            if (msgId && isMine) {
                await supabaseClient.from('messages').delete().eq('id', msgId);
            }
        }, appSettings.deleteSeconds * 1000);
    }
}



async function startRecordingMode() {

    if (!username) return alert("Ø³Ø¬Ù„ Ø§Ø³Ù…Ùƒ Ø£ÙˆÙ„Ø§Ù‹");

    if (isRecording) return;

    // show appropriate UI based on currentChatTarget

    if (currentChatTarget === 'public') {

        document.getElementById('msg-input').style.display = 'none';

        document.getElementById('recording-status').style.display = 'block';

        document.getElementById('cancel-record-btn').style.display = 'block';

        document.getElementById('record-trigger-btn').classList.add('active');

    } else {

        document.getElementById('private-msg-input').style.display = 'none';

        document.getElementById('private-recording-status').style.display = 'block';

        document.getElementById('private-cancel-record-btn').style.display = 'block';

        document.getElementById('private-record-trigger-btn').classList.add('active');

    }



    audioChunks = [];

    try {

        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });

        let options = MediaRecorder.isTypeSupported('audio/webm;codecs=opus') ? { mimeType: 'audio/webm;codecs=opus' } : { mimeType: 'audio/webm' };

        mediaRecorder = new MediaRecorder(stream, options);

        mediaRecorder.ondataavailable = event => { if (event.data.size > 0) audioChunks.push(event.data); };

        mediaRecorder.start();

        isRecording = true;

    } catch (err) { alert("Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…Ø§ÙŠÙƒØ±ÙˆÙÙˆÙ†"); cancelRecording(); }

}



function finishRecordingAndSend() {

    if (!isRecording || !mediaRecorder) return;

    mediaRecorder.onstop = async () => {

        const audioBlob = new Blob(audioChunks, { type: mediaRecorder.mimeType });

        const filePath = `${Date.now()}_voice.webm`;

        if(supabaseClient) {

            const { data, error } = await supabaseClient.storage.from(MEDIA_BUCKET_NAME).upload(filePath, audioBlob);

            if (!error) {

                const { data: urlData } = supabaseClient.storage.from(MEDIA_BUCKET_NAME).getPublicUrl(filePath);

                // send to correct table based on currentChatTarget

                const targetBefore = currentChatTarget;

                const savedTarget = currentChatTarget;

                sendMessage('', 'audio', urlData.publicUrl);

            }

        }

        mediaRecorder.stream.getTracks().forEach(track => track.stop());

        resetRecordingUI();

    };

    mediaRecorder.stop();

}



function cancelRecording() {

    if (mediaRecorder && mediaRecorder.state !== 'inactive') {

        mediaRecorder.onstop = null;

        mediaRecorder.stop();

        mediaRecorder.stream.getTracks().forEach(track => track.stop());

    }

    resetRecordingUI();

}



function resetRecordingUI() {

    isRecording = false;

    if (document.getElementById('msg-input')) document.getElementById('msg-input').style.display = 'block';

    if (document.getElementById('recording-status')) document.getElementById('recording-status').style.display = 'none';

    if (document.getElementById('cancel-record-btn')) document.getElementById('cancel-record-btn').style.display = 'none';

    if (document.getElementById('record-trigger-btn')) document.getElementById('record-trigger-btn').classList.remove('active');



    if (document.getElementById('private-msg-input')) document.getElementById('private-msg-input').style.display = 'block';

    if (document.getElementById('private-recording-status')) document.getElementById('private-recording-status').style.display = 'none';

    if (document.getElementById('private-cancel-record-btn')) document.getElementById('private-cancel-record-btn').style.display = 'none';

    if (document.getElementById('private-record-trigger-btn')) document.getElementById('private-record-trigger-btn').classList.remove('active');

}



function scrollToBottom() { const box = (currentChatTarget === 'private' && document.getElementById('private-chat-box')) ? document.getElementById('private-chat-box') : document.getElementById('chat-box'); if(box) box.scrollTop = box.scrollHeight; }

function triggerUpload(type) { if (!username) return alert("Ø³Ø¬Ù„ Ø§Ø³Ù…Ùƒ!"); document.getElementById(`upload-${type}`).dataset.target = 'public'; document.getElementById(`upload-${type}`).click(); }

function triggerPrivateUpload(type) { if (!username) return alert("Ø³Ø¬Ù„ Ø§Ø³Ù…Ùƒ!"); document.getElementById(`upload-${type}`).dataset.target = 'private'; document.getElementById(`upload-${type}`).click(); }



async function sendFile(input, type) {
    if (!input.files[0]) return;
    const file = input.files[0];
    
    // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø§Ù…ØªØ¯Ø§Ø¯ Ø§Ù„Ø£ØµÙ„ÙŠ Ù„Ù„Ù…Ù„Ù (Ù…Ø«Ù„ jpg Ø£Ùˆ png)
    const fileExt = file.name.split('.').pop();
    const filePath = `${Date.now()}_${Math.floor(Math.random()*1000)}.${fileExt}`;

    const target = input.dataset.target || 'public';
    
    if(supabaseClient) {
        const { data, error } = await supabaseClient.storage.from(MEDIA_BUCKET_NAME).upload(filePath, file);
        
        if(error) {
            console.error("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø±ÙØ¹:", error.message);
            alert("ÙØ´Ù„ Ø§Ù„Ø±ÙØ¹: " + error.message);
            return;
        }

        const { data: urlData } = supabaseClient.storage.from(MEDIA_BUCKET_NAME).getPublicUrl(filePath);
        const oldTarget = currentChatTarget;
        currentChatTarget = target === 'private' ? 'private' : 'public';
        
        sendMessage('', type, urlData.publicUrl);
        currentChatTarget = oldTarget;
    }
    input.value = "";
}




function toggleTimerInputState() {

    const chk = document.getElementById('timer-toggle').checked;

    document.getElementById('timer-setting').disabled = !chk;

    document.getElementById('timer-setting').style.opacity = chk ? "1" : "0.5";

}



function toggleInactivityInputState() {

    const chk = document.getElementById('inactivity-toggle').checked;

    document.getElementById('inactivity-setting').disabled = !chk;

    document.getElementById('inactivity-setting').style.opacity = chk ? "1" : "0.5";

}



function checkSettingsAccess() { if (prompt("Ø±Ù…Ø² Ø§Ù„Ù…Ø´Ø±Ù:") === appSettings.adminCode) openSettings(); }

function openSettings() { document.getElementById('settings-modal').style.display = 'flex'; populateSettingsUI(); }

function populateSettingsUI() {

    document.getElementById('inactivity-setting').value = appSettings.inactivityTimeout;

    document.getElementById('code-setting').value = appSettings.entranceCode;

    document.getElementById('timer-toggle').checked = appSettings.timerEnabled;

    document.getElementById('timer-setting').value = appSettings.deleteSeconds;

    document.getElementById('inactivity-toggle').checked = appSettings.inactivityEnabled;

    document.getElementById('admin-code-setting').value = appSettings.adminCode;

    toggleTimerInputState();

    toggleInactivityInputState();

}

function closeSettings() { document.getElementById('settings-modal').style.display = 'none'; }



async function saveSettings() {

    const nt = parseInt(document.getElementById('timer-setting').value);

    const ni = parseInt(document.getElementById('inactivity-setting').value);

    const nc = document.getElementById('code-setting').value.trim();

    const on = document.getElementById('timer-toggle').checked;

    const inactOn = document.getElementById('inactivity-toggle').checked;

    const ac = document.getElementById('admin-code-setting').value.trim();



    if(supabaseClient) {

        await supabaseClient.from('settings').upsert({ 

            id: 1, 

            delete_seconds: nt, 

            inactivity_timeout: ni, 

            entrance_code: nc, 

            timer_enabled: on,

            inactivity_enabled: inactOn,

            admin_code: ac

        });

        alert("âœ… ØªÙ… Ø§Ù„Ø­ÙØ¸"); closeSettings();

    }

}



async function deleteAllMessages() {

    if(confirm("Ø­Ø°Ù Ø§Ù„ÙƒÙ„ Ù…Ù† Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¹Ø§Ù…Ø©ØŸ") && supabaseClient) {

        await supabaseClient.from('messages').delete().neq('id', 0);

        document.getElementById('chat-box').innerHTML = '';

    }

}



// Ø­Ø°Ù Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØºØ±ÙØ© Ø§Ù„Ø³Ø±ÙŠØ© â€” Ù‡Ø°Ù‡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø®Ø§ØµØ© ÙˆØªØ¤ÙƒØ¯ Ù‚Ø¨Ù„ Ø§Ù„Ø­Ø°Ù

async function deleteAllPrivateMessages() {

    if(!supabaseClient) return;

    if(confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù ÙƒÙ„ Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†")) {

        await supabaseClient.from('private_messages').delete().neq('id', 0);

        if(document.getElementById('private-chat-box')) document.getElementById('private-chat-box').innerHTML = '';

        alert('ØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†');

    }

}



function showArticle(id) {

    const a = articlesData[id];

    if(a) {

        document.getElementById('view-img').src = a.img;

        document.getElementById('view-title').textContent = a.title;

        document.getElementById('view-text').innerHTML = a.text;

        document.getElementById('article-viewer').style.display = 'block';

    }

}

function closeArticle() { document.getElementById('article-viewer').style.display = 'none'; }



// ØªÙˆØ³ÙŠØ¹ Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ (Ù‚Ø§Ø¦Ù…Ø© Ø£Ø·ÙˆÙ„)

const emojiList = ["ğŸ˜€","ğŸ˜","ğŸ˜‚","ğŸ¤£","ğŸ˜ƒ","ğŸ˜„","ğŸ˜…","ğŸ˜†","ğŸ˜‰","ğŸ˜Š","ğŸ™‚","ğŸ™ƒ","ğŸ˜","ğŸ˜˜","ğŸ˜—","ğŸ˜™","ğŸ˜š","ğŸ˜‹","ğŸ˜œ","ğŸ¤ª","ğŸ¤©","ğŸ¥³","ğŸ˜","ğŸ¤”","ğŸ¤¨","ğŸ˜","ğŸ˜‘","ğŸ˜¶","ğŸ˜","ğŸ¤«","ğŸ¤—","ğŸ¤­","ğŸ˜´","ğŸ¤¤","ğŸ˜µ","ğŸ˜­","ğŸ˜¡","ğŸ¤¬","ğŸ‘","ğŸ‘","ğŸ‘","ğŸ™Œ","ğŸ™","ğŸ’ª","ğŸ”¥","â¤ï¸","ğŸ’”","ğŸ’–","âœ¨","ğŸŒŸ","ğŸŒ¹","ğŸ’","ğŸ’‹","ğŸ’ƒ","ğŸ•º","ğŸ‰","ğŸ¶","ğŸ¯","âš½","ğŸ†","ğŸ¬","ğŸ®","ğŸ“¸"];

const emojiPicker = document.getElementById('emoji-picker');

emojiList.forEach(e => {

    const s = document.createElement('span'); s.className='emoji-item'; s.textContent=e;

    s.onclick=()=>{ if(currentChatTarget==='private') document.getElementById('private-msg-input').value+=e; else document.getElementById('msg-input').value+=e; toggleEmoji()}

    emojiPicker.appendChild(s);

});

function toggleEmoji() { 

    document.getElementById('sticker-picker').style.display = 'none';

    document.getElementById('radio-picker').style.display = 'none';

    emojiPicker.style.display = emojiPicker.style.display==='flex'?'none':'flex'; 

}



function startInactivityTimer() { 

    if(!appSettings.inactivityEnabled) return;

    clearTimeout(inactivityTimer); 

    inactivityTimer = setTimeout(() => { alert("Ø§Ù†ØªÙ‡Øª Ø§Ù„Ø¬Ù„Ø³Ø©"); exitChat(); }, appSettings.inactivityTimeout * 1000); 

}

function resetInactivityTimer() { 

    if (document.getElementById('chat-interface').style.display === 'flex') startInactivityTimer(); 

}

document.getElementById('msg-input').addEventListener('input', resetInactivityTimer);



// ===== Ø§Ù„Ø®ØµØ§Ø¦Øµ Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ù„ÙØªØ­ ÙˆØ§Ù„ØºÙ„Ù‚ Ù„Ù„Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„Ø³Ø±ÙŠØ© =====

function openPrivateLock() {

    const pwd = prompt('Ù‚Ø³Ù… Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†');

    if (pwd === '1993') {

        openPrivateChat();

    } else {

        alert('ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ØºÙŠØ± ØµØ­ÙŠØ­Ø©');

    }

}



function openPrivateChat() {
    // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¹Ø§Ù… ÙˆØ¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØºØ±ÙØ© Ø§Ù„Ø³Ø±ÙŠØ©
    document.getElementById('chat-interface').style.display = 'none';
    document.getElementById('private-chat-interface').style.display = 'flex';
    currentChatTarget = 'private';
    
    // Ù†Ù‚ÙˆÙ… ÙÙ‚Ø· Ø¨ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©ØŒ Ù„Ø£Ù† Ø§Ù„Ù…Ø³ØªÙ…Ø¹ ÙŠØ¹Ù…Ù„ Ø¨Ø§Ù„ÙØ¹Ù„ Ù…Ù†Ø° Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
    loadRecentPrivateMessages(); 
    
    // ØªÙ… Ø­Ø°Ù Ø§Ù„Ø³Ø·Ø± Ø§Ù„Ù…Ø³Ø¨Ø¨ Ù„Ù„ØªÙƒØ±Ø§Ø± Ù‡Ù†Ø§
}



// --- FIX: make pickers available in both public & private chats ---

// Move the pickers out of the chat container so they are not hidden

['sticker-picker','emoji-picker','radio-picker'].forEach(id=>{

    const el = document.getElementById(id);

    if (el && el.parentNode !== document.body) {

        // keep current display/style but move to body to avoid being hidden

        document.body.appendChild(el);

    }

});



// If there's a private emoji container, populate it with the same emoji items

const privateEmojiContainer = document.getElementById('private-emoji-picker');

if (privateEmojiContainer) {

    // Avoid duplicating if already populated

    if (!privateEmojiContainer.dataset.populated) {

        // use the same emojiList that you already have

        if (typeof emojiList !== 'undefined' && Array.isArray(emojiList)) {

            emojiList.forEach(e => {

                const s = document.createElement('span');

                s.className = 'emoji-item';

                s.textContent = e;

                s.onclick = () => {

                    // insert into the correct input based on current chat target

                    if (currentChatTarget === 'private') {

                        const inp = document.getElementById('private-msg-input');

                        if (inp) inp.value += e;

                    } else {

                        const inp = document.getElementById('msg-input');

                        if (inp) inp.value += e;

                    }

                    // keep existing toggle behavior

                    toggleEmoji();

                };

                privateEmojiContainer.appendChild(s);

            });

        }

        privateEmojiContainer.dataset.populated = '1';

    }

}



// Ensure pickers have very high z-index so they appear above other overlays (optional)

const ensureZ = ['sticker-picker','emoji-picker','radio-picker'];

ensureZ.forEach(id=>{

    const el = document.getElementById(id);

    if (el) el.style.zIndex = el.style.zIndex || '9999';

});

async function deleteSingleMessage(msgId, type) {
    if (!confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø±Ø³Ø§Ù„Ø©ØŸ")) return;
    const table = type === 'private' ? 'private_messages' : 'messages';
    const { error } = await supabaseClient.from(table).delete().eq('id', msgId);
    if (error) alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­Ø°Ù: " + error.message);
}

async function editMessage(msgId, type) {
    const table = type === 'private' ? 'private_messages' : 'messages';
    const msgElement = document.getElementById((type === 'private' ? 'msg-private-' : 'msg-') + msgId);
    const oldText = msgElement.querySelector('.msg-text-content').textContent;
    const newText = prompt("ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©:", oldText);
    
    if (newText && newText !== oldText) {
        const { error } = await supabaseClient.from(table).update({ content: newText }).eq('id', msgId);
        if (error) alert("ÙØ´Ù„ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„: " + error.message);
    }
}


</script></body>



</html>
